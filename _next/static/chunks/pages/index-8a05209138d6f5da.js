(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5356:function(t,e,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(7632)}])},7632:function(t,e,a){"use strict";let s;a.r(e),a.d(e,{default:function(){return S}});var i=a(2322),r=a(2784),n=a(4360);let l=new class{constructor(){this.setNetwork("mainnet")}setNetwork(t){"mainnet"===t?(this.algod=new n.default.Algodv2("","https://mainnet-api.algonode.cloud",443),this.indexer=new n.default.Indexer("","https://mainnet-idx.algonode.cloud",443)):(this.algod=new n.default.Algodv2("","https://testnet-api.algonode.cloud",443),this.indexer=new n.default.Indexer("","https://testnet-idx.algonode.cloud",443))}};var o=a(8834).lW;new class{constructor(){this.type,this.wallet,this.address,this.disconnectedCallback,this.suggestedParams,this.shouldSelectOneAccount=!0}async reconnect(){if(console.log(`Reconnecting ${localStorage?.walletType}...`),localStorage?.walletType==="pera"){let{PeraWalletConnect:t}=await Promise.all([a.e(642),a.e(840),a.e(196)]).then(a.t.bind(a,7840,19));this.wallet=new t,this.wallet.connector?.on("disconnect",this.disconnected);let e=await this.wallet.reconnectSession();this.address=e?.[0],localStorage.walletAddress=this.address}else if(localStorage?.walletType==="myalgo"&&localStorage?.walletAddress){let s=await Promise.resolve().then(a.t.bind(a,7057,19));this.wallet=new s.default,this.address=localStorage.walletAddress}this.address?this.type=localStorage?.walletType:this.type=void 0}async connect(t){if("pera"===t){let{PeraWalletConnect:e}=await Promise.all([a.e(642),a.e(840),a.e(196)]).then(a.t.bind(a,7840,19));this.wallet=new e,await this.connectPera(),this.type="pera"}else if("myalgo"===t){let s=await Promise.resolve().then(a.t.bind(a,7057,19));this.wallet=new s.default,await this.connectMyAlgo(),this.type="myalgo"}localStorage.walletAddress=this.address,localStorage.walletType=this.type}async connectMyAlgo(){let t=await this.wallet?.connect({shouldSelectOneAccount:this.shouldSelectOneAccount});this.address=t?.[0]?.address}async connectPera(){let t=await this.wallet.connect();this.address=t?.[0],this.wallet.connector?.on("disconnect",this.disconnected)}async disconnect(){"pera"===this.type&&await this.wallet?.disconnect(),this.disconnected()}disconnected(){console.log(`Wallet disconnected ${this.type}`),this.address=void 0,this.type=void 0,localStorage.walletAddress=void 0,localStorage.walletType=void 0,this.disconnectedCallback?.()}async signTransactions(t){if("pera"===this.type){let e=t.map(t=>({txn:t,signers:[n.default.encodeAddress(t.from.publicKey)]})),a=await this.wallet.signTransaction([e]);return a}if("myalgo"===this.type){let s=t.filter(t=>n.default.encodeAddress(t.from.publicKey)===this.address),i=await this.wallet.signTransaction(s.map(t=>t.toByte()));return i.map(t=>t.blob)}}async loadSuggestedParams(){console.log("- load suggested params"),this.suggestedParams=await l.algod.getTransactionParams().do(),setTimeout(this.loadSuggestedParams,18e5)}async getAuth(){if(!this.suggestedParams)throw Error("Suggested params not available");let t=n.default.makePaymentTxnWithSuggestedParamsFromObject({from:this.address,to:this.address,amount:0,suggestedParams:this.suggestedParams}),e=await this.signTransactions([t]),a=o.from(e[0]).toString("base64");return a}};var d=a(4303),c=a(2992),h=a(3105),u=a(8834).lW;let m="#arc3";async function g(t,e,a,i,r,l,o=!1){s||(s=await t.getTransactionParams().do());let c=function(t){let e=d.k.parse(t);return(0,n.encodeAddress)(Uint8Array.from(u.from(e.multihash.digest)))}(i),h={from:a,assetIndex:e,manager:a,reserve:c,suggestedParams:s,strictEmptyAddressChecking:!1,note:r},m=n.default.makeAssetConfigTxnWithSuggestedParamsFromObject(h);if(o)return h;let g=n.default.mnemonicToSecretKey(l).sk,p=m.signTxn(g),f=m.txID().toString();await t.sendRawTransaction(p).do();let w=await n.default.waitForConfirmation(t,f,4);return console.log(`Confirmed: ${f}`),w}a(8834).lW,a(8834).lW,a(2895),a(4050),a(6795),a(8127);var p={primaryIpfsGatewayUrl:"https://ipfs.algonode.xyz/ipfs",secondaryIpfsGatewayUrl:"https://ipfs.io/ipfs"},f=a(6279);class w{constructor(t,e){this.assetId=t,this.name,this.unitName,this.url,this.total,this.reserve,this.cid,e&&e.params&&(this.name=e.params.name,this.unitName=e.params["unit-name"],this.url=e.params.url,this.total=e.params.total,this.reserve=e.params.reserve),this.amount,this.imageUrl,this.imageUrlAlternate,this.metadata,this.isLoaded=!1}async load(t,e=!1){if(this.url){if(e)try{await this.loadWithPera()}catch(a){console.error(a)}(!this.imageUrl||this.imageUrl.startsWith("null")||this.imageUrl.startsWith("undefined"))&&(this.url.startsWith("template-ipfs://")?(await this.loadARC69(t),await this.loadARC19(t)):this.url.endsWith("#arc3")?await this.loadARC3(t):await this.loadARC69(t)),this.isLoaded=!0}}async loadWithPera(){let t=await f(`${p.peraApiUrl}/assets/${this.assetId}`);if(200===t.status){let e=await t.json();if(e.collectible&&(this.imageUrl=e.collectible.primary_image+"?width=512",e.collectible?.traits?.length>0)){let a={};for(let s of e.collectible.traits)a[s.display_name]=s.display_value;this.metadata={properties:a}}}else throw Error(`Fetching pera error ${t.status}`)}async loadARC3(t){let e=this.url.split("//");e=e[1].split("#");let a=e[0];this.cid=a,await this.loadIpfsMetadata(a)}async loadARC19(t){let e=function(t,e){let a;let s=(a=t.endsWith(m)?t.slice(0,t.length-m.length):t).split("://");if("template-ipfs"===s[0]&&s[1].startsWith("{ipfscid:")){let i;s[0]="ipfs";let r=s[1].split(":");if(5!==r.length)return console.log("unknown ipfscid format"),a;let[,l,o,u,g]=r;if("sha2-256"!==g.split("}")[0])return console.log("unsupported hash:",g),a;if("raw"!==o&&"dag-pb"!==o)return console.log("unsupported codec:",o),a;if("reserve"!==u)return console.log("unsupported asa field:",u),a;"raw"===o?i=85:"dag-pb"===o&&(i=112);let p=(0,n.decodeAddress)(e),f=h.Ue(c.J.code,p.publicKey),w=d.k.create(parseInt(l),i,f);return w.toString()}}(this.url,this.reserve);this.cid=e,await this.loadIpfsMetadata(e)}b64DecodeUnicode(t){return decodeURIComponent(atob(t).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""))}async loadARC69(t){if(this.url.startsWith("ipfs://")){let e=this.url.split("//");e=e[1].split("#");let a=e[0];this.cid=a,a&&(this.imageUrl=`${p.primaryIpfsGatewayUrl}/${a}`,this.imageUrlAlternate=`${p.secondaryIpfsGatewayUrl}/${a}`)}else(this.url.startsWith("http://")||this.url.startsWith("https://"))&&(this.imageUrl=this.url,this.imageUrlAlternate=this.url);let s=await t.lookupAssetTransactions(this.assetId).txType("acfg").do(),i=s.transactions;for(let r of(i.sort((t,e)=>e["round-time"]-t["round-time"]),i))try{let n=r.note,l=this.b64DecodeUnicode(n),o=JSON.parse(l);if("arc69"===o.standard){this.metadata=o;break}}catch(d){}}async loadIpfsMetadata(t){let e;try{let a=await f(`${p.primaryIpfsGatewayUrl}/${t}`);if(200===a.status){let s=a.headers.get("Content-Type");if(s.includes("json"))e=await a.json();else if(s.includes("image"))e=null,this.imageUrl=`${p.primaryIpfsGatewayUrl}/${t}`,this.imageUrlAlternate=`${p.secondaryIpfsGatewayUrl}/${t}`;else throw Error("Unknown file type for ARC19")}else throw Error(`Fetching ipfs metadata error ${a.status} (primary gateaway)`)}catch(l){console.error(l);let i=await f(`${p.secondaryIpfsGatewayUrl}/${t}`);if(200===i.status){let r=i.headers.get("Content-Type");if(r.includes("json"))e=await i.json();else if(r.includes("image"))this.imageUrl=`${p.primaryIpfsGatewayUrl}/${t}`,this.imageUrlAlternate=`${p.secondaryIpfsGatewayUrl}/${t}`;else throw Error("Unknown file type for ARC19")}else{let n=Error(`Fetching ipfs metadata error ${i.status} (secondary gateway)`);throw n.status=i.status,n}}if(e){let o=e.image.split("//");"ipfs:"===o[0]&&(this.imageUrl=`${p.primaryIpfsGatewayUrl}/${o[1]}`,this.imageUrlAlternate=`${p.secondaryIpfsGatewayUrl}/${o[1]}`)}this.metadata=e}handleImageError(t){t.addEventListener("error",e=>{this.imageUrlAlternate&&t.src!==this.imageUrlAlternate&&(t.src=this.imageUrlAlternate)})}}async function y(t,e){let a=await fetch("https://api.nft.storage/upload",{method:"post",body:t,headers:{"Content-Type":t.type,Authorization:"Bearer ".concat(e)}}),s=await a.json();return s}var b=a(7057),x=a.n(b),v=a(1692),A=a(7729),k=a.n(A),N=a(8764).lW;function S(){let t=(0,r.useRef)(),e=(0,r.useRef)(),[a,s]=(0,r.useState)(),[n,o]=(0,r.useState)(),[d,c]=(0,r.useState)(!1);async function h(t){let e=new(x()),a=await e.connect({shouldSelectOneAccount:!0});o(a[0].address),s(e)}async function u(e){t.current.metadata.disabled=!0;let a=t.current["asset-id"].value;l.setNetwork(t.current.network.value);try{let s=await l.algod.getAssetByID(a).do(),i=new w(a,s);await i.load(l.indexer),console.log(i),t.current.metadata.value=JSON.stringify(i.metadata,null,4),i.metadata?(t.current.metadata.disabled=!1,t.current.metadata.style.color=""):t.current.metadata.style.color="lightgray"}catch(r){alert(r.message)}}async function m(s){var i;let r,o;s.preventDefault(),c(!0);let d={network:s.target.network.value,nftStorageToken:s.target["nft-storage-token"].value,assetId:parseInt(t.current["asset-id"].value),metadata:s.target.metadata.value,imageFile:null===(i=s.target["image-file"].files)||void 0===i?void 0:i[0]};l.setNetwork(d.network.value);try{if(d.imageFile){e.current.innerHTML="Sending image to IPFS...";let h=await y(d.imageFile,d.nftStorageToken);if(!h.ok){alert("Error uploading to nft.storage");return}r=h.value.cid,e.current.innerHTML+="<br />Sent (cid: ".concat(r,")")}else e.current.innerHTML+="<br />No image file";if("null"!==d.metadata){e.current.innerHTML+="<br />Updating metadata";let u=JSON.parse(d.metadata);r&&(u.image="ipfs://".concat(r),u.image_mimetype=d.imageFile.type,s.target.metadata.value=JSON.stringify(u,null,4)),e.current.innerHTML+="<br />Sending metadata to IPFS...";let m=new File([s.target.metadata.value],null,{type:"application/json"}),p=await y(m,d.nftStorageToken);if(!p.ok){alert("Error uploading metadata to nft.storage");return}o=p.value.cid,e.current.innerHTML+="<br />Sent (cid: ".concat(o,")")}else e.current.innerHTML+="<br />No metadata";e.current.innerHTML+="<br />Preparing transaction...";let f=o;if(f||(f=r),!f){alert("Can't find a cid (metadata & image missing?)");return}let w=await g(l.algod,d.assetId,n,f,void 0,null,!0),b=v.ZP.makeAssetConfigTxnWithSuggestedParamsFromObject(w);e.current.innerHTML+="<br />Waiting for signature (make sure popup blocker is disabled)...";let[x]=await a.signTxns([{txn:N.from(b.toByte()).toString("base64")}]);e.current.innerHTML+="<br />Sending transaction to the network...";let{txId:A}=await l.algod.sendRawTransaction(N.from(x,"base64")).do();e.current.innerHTML+="<br />Waiting for confirmation (tx id: ".concat(A,")...");let k=await v.ZP.waitForConfirmation(l.algod,A,3);e.current.innerHTML+="<br />Confirmed!",console.log(k)}catch(S){alert(S.message)}c(!1)}return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(k(),{children:(0,i.jsx)("title",{children:"ARC19 updater"})}),(0,i.jsxs)("div",{className:"p-4",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold mb-5",children:"ARC19 Updater"}),(0,i.jsx)("div",{className:"text-gray-400 mb-4",children:"Popup blocker must be disabled"}),(0,i.jsxs)("div",{className:"",children:[(0,i.jsxs)("form",{onSubmit:m,ref:t,children:[(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("div",{className:"font-bold",children:"Manager wallet"}),n?(0,i.jsx)(i.Fragment,{children:n}):(0,i.jsx)("button",{type:"button",className:"rounded bg-black text-white px-4 py-2",onClick:h,children:"Connect (myalgo)"})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("div",{className:"font-bold",children:"Network"}),(0,i.jsx)("input",{type:"radio",id:"testnet",name:"network",className:"mr-1",value:"testnet",defaultChecked:!0}),(0,i.jsx)("label",{htmlFor:"testnet",className:"mr-3 align-middle",children:"Testnet"}),(0,i.jsx)("input",{type:"radio",id:"mainnet",className:"mr-1",name:"network",value:"mainnet"}),(0,i.jsx)("label",{htmlFor:"mainnet",className:"align-middle",children:"Mainnet"})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("div",{className:"font-bold",children:"nft.storage token"}),(0,i.jsx)("input",{type:"text",id:"nft-storage-token",className:"rounded",required:!0})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("div",{className:"font-bold",children:"Asset ID"}),(0,i.jsx)("input",{type:"text",id:"asset-id",className:"rounded mr-4",onChange:function(e){t.current.metadata.value=""},required:!0}),(0,i.jsx)("button",{type:"button",className:"rounded bg-black text-white px-4 py-2",onClick:u,children:"Load"})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("div",{className:"font-bold",children:"Metadata"}),(0,i.jsx)("textarea",{id:"metadata",className:"font-mono rounded resize",required:!0})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("div",{className:"font-bold",children:"New image"}),(0,i.jsx)("input",{type:"file",id:"image-file",className:"rounded mr-4"})]}),(0,i.jsx)("button",{type:"submit",className:"rounded bg-black text-white px-4 py-2 disabled:bg-gray-200",disabled:d,children:"Send"})]}),(0,i.jsx)("div",{className:"text-gray-400",ref:e})]})]})]})}},5338:function(){},8127:function(){},2895:function(){},6795:function(){}},function(t){t.O(0,[47,774,888,179],function(){return t(t.s=5356)}),_N_E=t.O()}]);