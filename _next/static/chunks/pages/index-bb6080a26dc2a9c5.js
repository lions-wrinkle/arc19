(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5356:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(7632)}])},7632:function(e,t,a){"use strict";let s;a.r(t),a.d(t,{default:function(){return j}});var i=a(2322),r=a(2784),n=a(4360);let l=new class{constructor(){this.setNetwork("mainnet")}setNetwork(e){"mainnet"===e?(this.algod=new n.default.Algodv2("","https://mainnet-api.algonode.cloud",443),this.indexer=new n.default.Indexer("","https://mainnet-idx.algonode.cloud",443)):(this.algod=new n.default.Algodv2("","https://testnet-api.algonode.cloud",443),this.indexer=new n.default.Indexer("","https://testnet-idx.algonode.cloud",443))}};var o=a(8834).lW;let d=new class{constructor(){this.type,this.wallet,this.address,this.disconnectedCallback,this.suggestedParams,this.shouldSelectOneAccount=!0}async reconnect(){if(console.log(`Reconnecting ${localStorage?.walletType}...`),localStorage?.walletType==="pera"){let{PeraWalletConnect:e}=await Promise.all([a.e(775),a.e(840),a.e(196)]).then(a.t.bind(a,7840,19));this.wallet=new e,this.wallet.connector?.on("disconnect",this.disconnected);let t=await this.wallet.reconnectSession();t&&(this.address=t?.[0],localStorage.walletAddress=this.address)}else if(localStorage?.walletType==="myalgo"&&localStorage?.walletAddress){let s=await Promise.resolve().then(a.t.bind(a,7057,19));this.wallet=new s.default,this.address=localStorage.walletAddress}this.address?this.type=localStorage?.walletType:this.type=void 0}async connect(e){if("pera"===e){let{PeraWalletConnect:t}=await Promise.all([a.e(775),a.e(840),a.e(196)]).then(a.t.bind(a,7840,19));this.wallet=new t,await this.connectPera(),this.type="pera"}else if("myalgo"===e){let s=await Promise.resolve().then(a.t.bind(a,7057,19));this.wallet=new s.default,await this.connectMyAlgo(),this.type="myalgo"}localStorage.walletAddress=this.address,localStorage.walletType=this.type}async connectMyAlgo(){let e=await this.wallet?.connect({shouldSelectOneAccount:this.shouldSelectOneAccount});this.address=e?.[0]?.address}async connectPera(){try{let e=await this.wallet.connect();this.address=e?.[0],this.wallet.connector?.on("disconnect",this.disconnected)}catch(t){console.error(t),this.wallet.disconnect()}}async disconnect(){"pera"===this.type&&await this.wallet?.disconnect(),this.disconnected()}disconnected(){console.log(`Wallet disconnected ${this.type}`),this.address=void 0,this.type=void 0,localStorage.walletAddress=void 0,localStorage.walletType=void 0,this.disconnectedCallback?.()}async signTransactions(e){if("pera"===this.type){let t=e.map(e=>({txn:e,signers:[n.default.encodeAddress(e.from.publicKey)]})),a=await this.wallet.signTransaction([t]);return a}if("myalgo"===this.type){let s=e.filter(e=>n.default.encodeAddress(e.from.publicKey)===this.address),i=await this.wallet.signTransaction(s.map(e=>e.toByte()));return i.map(e=>e.blob)}}async loadSuggestedParams(){console.log("- load suggested params"),this.suggestedParams=await l.algod.getTransactionParams().do(),setTimeout(this.loadSuggestedParams,18e5)}async getAuth(){if(!this.suggestedParams)throw Error("Suggested params not available");let e=n.default.makePaymentTxnWithSuggestedParamsFromObject({from:this.address,to:this.address,amount:0,suggestedParams:this.suggestedParams}),t=await this.signTransactions([e]),a=o.from(t[0]).toString("base64");return a}};var c=d,h=a(4303),m=a(2992),u=a(3105),g=a(8834).lW;let p="#arc3";async function f(e,t,a,i,r,l,o=!1){s||(s=await e.getTransactionParams().do());let d=function(e){let t=h.k.parse(e);return(0,n.encodeAddress)(Uint8Array.from(g.from(t.multihash.digest)))}(i),c={from:a,assetIndex:t,manager:a,reserve:d,suggestedParams:s,strictEmptyAddressChecking:!1,note:r},m=n.default.makeAssetConfigTxnWithSuggestedParamsFromObject(c);if(o)return c;let u=n.default.mnemonicToSecretKey(l).sk,p=m.signTxn(u),f=m.txID().toString();await e.sendRawTransaction(p).do();let w=await n.default.waitForConfirmation(e,f,4);return console.log(`Confirmed: ${f}`),w}a(8834).lW,a(8834).lW,a(2895),a(4050),a(6795),a(8127);var w={primaryIpfsGatewayUrl:"https://ipfs.algonode.xyz/ipfs",secondaryIpfsGatewayUrl:"https://ipfs.io/ipfs"},y=a(6279);class b{constructor(e,t){this.assetId=e,this.name,this.unitName,this.url,this.total,this.reserve,this.cid,t&&t.params&&(this.name=t.params.name,this.unitName=t.params["unit-name"],this.url=t.params.url,this.total=t.params.total,this.reserve=t.params.reserve),this.amount,this.imageUrl,this.imageUrlAlternate,this.metadata,this.isLoaded=!1}async load(e,t=!1){if(this.url){if(t)try{await this.loadWithPera()}catch(a){console.error(a)}(!this.imageUrl||this.imageUrl.startsWith("null")||this.imageUrl.startsWith("undefined"))&&(this.url.startsWith("template-ipfs://")?(await this.loadARC69(e),await this.loadARC19(e)):this.url.endsWith("#arc3")?await this.loadARC3(e):await this.loadARC69(e)),this.isLoaded=!0}}async loadWithPera(){let e=await y(`${w.peraApiUrl}/assets/${this.assetId}`);if(200===e.status){let t=await e.json();if(t.collectible&&(this.imageUrl=t.collectible.primary_image+"?width=512",t.collectible?.traits?.length>0)){let a={};for(let s of t.collectible.traits)a[s.display_name]=s.display_value;this.metadata={properties:a}}}else throw Error(`Fetching pera error ${e.status}`)}async loadARC3(e){let t=this.url.split("//");t=t[1].split("#");let a=t[0];this.cid=a,await this.loadIpfsMetadata(a)}async loadARC19(e){let t=function(e,t){let a;let s=(a=e.endsWith(p)?e.slice(0,e.length-p.length):e).split("://");if("template-ipfs"===s[0]&&s[1].startsWith("{ipfscid:")){let i;s[0]="ipfs";let r=s[1].split(":");if(5!==r.length)return console.log("unknown ipfscid format"),a;let[,l,o,d,c]=r;if("sha2-256"!==c.split("}")[0])return console.log("unsupported hash:",c),a;if("raw"!==o&&"dag-pb"!==o)return console.log("unsupported codec:",o),a;if("reserve"!==d)return console.log("unsupported asa field:",d),a;"raw"===o?i=85:"dag-pb"===o&&(i=112);let g=(0,n.decodeAddress)(t),f=u.Ue(m.J.code,g.publicKey),w=h.k.create(parseInt(l),i,f);return w.toString()}}(this.url,this.reserve);this.cid=t,await this.loadIpfsMetadata(t)}b64DecodeUnicode(e){return decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}async loadARC69(e){if(this.url.startsWith("ipfs://")){let t=this.url.split("//");t=t[1].split("#");let a=t[0];this.cid=a,a&&(this.imageUrl=`${w.primaryIpfsGatewayUrl}/${a}`,this.imageUrlAlternate=`${w.secondaryIpfsGatewayUrl}/${a}`)}else if(this.url.startsWith("http://")||this.url.startsWith("https://")){let s=RegExp("Qm[1-9A-HJ-NP-Za-km-z]{44,}|b[A-Za-z2-7]{58,}|B[A-Z2-7]{58,}|z[1-9A-HJ-NP-Za-km-z]{48,}|F[0-9A-F]{50,}"),i=s.exec(this.url),r=i?.[0];r?(this.imageUrl=`${w.primaryIpfsGatewayUrl}/${r}`,this.imageUrlAlternate=`${w.secondaryIpfsGatewayUrl}/${r}`):(this.imageUrl=this.url,this.imageUrlAlternate=this.url)}let n=await e.lookupAssetTransactions(this.assetId).txType("acfg").do(),l=n.transactions;for(let o of(l.sort((e,t)=>t["round-time"]-e["round-time"]),l))try{let d=o.note,c=this.b64DecodeUnicode(d),h=JSON.parse(c);if("arc69"===h.standard){this.metadata=h;break}}catch(m){}}async loadIpfsMetadata(e){let t;try{let a=await y(`${w.primaryIpfsGatewayUrl}/${e}`);if(200===a.status){let s=a.headers.get("Content-Type");if(s.includes("json"))t=await a.json();else if(s.includes("image"))t=null,this.imageUrl=`${w.primaryIpfsGatewayUrl}/${e}`,this.imageUrlAlternate=`${w.secondaryIpfsGatewayUrl}/${e}`;else throw Error("Unknown file type for ARC19")}else throw Error(`Fetching ipfs metadata error ${a.status} (primary gateaway)`)}catch(l){console.error(l);let i=await y(`${w.secondaryIpfsGatewayUrl}/${e}`);if(200===i.status){let r=i.headers.get("Content-Type");if(r.includes("json"))t=await i.json();else if(r.includes("image"))this.imageUrl=`${w.primaryIpfsGatewayUrl}/${e}`,this.imageUrlAlternate=`${w.secondaryIpfsGatewayUrl}/${e}`;else throw Error("Unknown file type for ARC19")}else{let n=Error(`Fetching ipfs metadata error ${i.status} (secondary gateway)`);throw n.status=i.status,n}}if(t){let o=t.image.split("//");"ipfs:"===o[0]&&(this.imageUrl=`${w.primaryIpfsGatewayUrl}/${o[1]}`,this.imageUrlAlternate=`${w.secondaryIpfsGatewayUrl}/${o[1]}`)}this.metadata=t}handleImageError(e){e.addEventListener("error",t=>{this.imageUrlAlternate&&e.src!==this.imageUrlAlternate&&(e.src=this.imageUrlAlternate)})}}async function x(e,t){let a=await fetch("https://api.nft.storage/upload",{method:"post",body:e,headers:{"Content-Type":e.type,Authorization:"Bearer ".concat(t)}}),s=await a.json();return s}a(7057);var v=a(1692),A=a(7729),k=a.n(A),N=a(8764).lW;function j(){let e=(0,r.useRef)(),t=(0,r.useRef)(),[a,s]=(0,r.useState)(),[n,o]=(0,r.useState)(!1);async function d(){await c.reconnect(),s(c.address),c.disconnectedCallback=()=>{s(void 0)}}async function h(e){await c.connect("pera"),s(c.address)}async function m(t){e.current.metadata.disabled=!0;let a=e.current["asset-id"].value;l.setNetwork(e.current.network.value);try{let s=await l.algod.getAssetByID(a).do(),i=new b(a,s);await i.load(l.indexer),e.current.metadata.value=JSON.stringify(i.metadata,null,4),i.metadata?(e.current.metadata.disabled=!1,e.current.metadata.style.color=""):e.current.metadata.style.color="lightgray"}catch(r){alert(r.message)}}async function u(s){var i;let r,n;s.preventDefault(),o(!0);let d={network:s.target.network.value,nftStorageToken:s.target["nft-storage-token"].value,assetId:parseInt(e.current["asset-id"].value),metadata:s.target.metadata.value,imageFile:null===(i=s.target["image-file"].files)||void 0===i?void 0:i[0]};l.setNetwork(d.network);try{if(d.imageFile){t.current.innerHTML="Sending image to IPFS...";let h=await x(d.imageFile,d.nftStorageToken);if(!h.ok){alert("Error uploading to nft.storage");return}r=h.value.cid,t.current.innerHTML+="<br />Sent (cid: ".concat(r,")")}else t.current.innerHTML+="<br />No image file";if("null"!==d.metadata){t.current.innerHTML+="<br />Updating metadata";let m=JSON.parse(d.metadata);r&&(m.image="ipfs://".concat(r),m.image_mimetype=d.imageFile.type,s.target.metadata.value=JSON.stringify(m,null,4)),t.current.innerHTML+="<br />Sending metadata to IPFS...";let u=new File([s.target.metadata.value],null,{type:"application/json"}),g=await x(u,d.nftStorageToken);if(!g.ok){alert("Error uploading metadata to nft.storage"),o(!1);return}n=g.value.cid,t.current.innerHTML+="<br />Sent (cid: ".concat(n,")")}else t.current.innerHTML+="<br />No metadata";t.current.innerHTML+="<br />Preparing transaction...";let p=n;if(p||(p=r),!p){alert("Can't find a cid (metadata & image missing?)");return}let w=await f(l.algod,d.assetId,a,p,void 0,null,!0),y=v.ZP.makeAssetConfigTxnWithSuggestedParamsFromObject(w);t.current.innerHTML+="<br />Waiting for signature (make sure popup blocker is disabled)...";let[b]=await c.signTransactions([y]);t.current.innerHTML+="<br />Sending transaction to the network...";let{txId:A}=await l.algod.sendRawTransaction(N.from(b,"base64")).do();t.current.innerHTML+="<br />Waiting for confirmation (tx id: ".concat(A,")...");let k=await v.ZP.waitForConfirmation(l.algod,A,3);t.current.innerHTML+="<br />Confirmed!",console.log(k)}catch(j){alert(j.message),t.current.innerHTML+='<br /><span class="text-red">'.concat(j.message,"</span>")}o(!1)}return(0,r.useEffect)(()=>{d()},[]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(k(),{children:(0,i.jsx)("title",{children:"ARC19 updater"})}),(0,i.jsxs)("div",{className:"p-4",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold mb-5",children:"ARC19 Updater"}),(0,i.jsx)("div",{className:"text-gray-400 mb-4",children:"Popup blocker must be disabled."}),(0,i.jsxs)("div",{className:"",children:[(0,i.jsxs)("form",{onSubmit:u,ref:e,children:[(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("div",{className:"font-bold",children:"Manager wallet"}),a?(0,i.jsxs)(i.Fragment,{children:[a," ",(0,i.jsx)("button",{type:"button",className:"rounded bg-black text-white px-4 py-2 ml-3",onClick:function(){c.disconnect()},children:"Disconnect"})]}):(0,i.jsx)("button",{type:"button",className:"rounded bg-black text-white px-4 py-2",onClick:h,children:"Connect (pera)"})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("div",{className:"font-bold",children:"Network"}),(0,i.jsx)("input",{type:"radio",id:"testnet",name:"network",className:"mr-1",value:"testnet",defaultChecked:!0}),(0,i.jsx)("label",{htmlFor:"testnet",className:"mr-3 align-middle",children:"Testnet"}),(0,i.jsx)("input",{type:"radio",id:"mainnet",className:"mr-1",name:"network",value:"mainnet"}),(0,i.jsx)("label",{htmlFor:"mainnet",className:"align-middle",children:"Mainnet"})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("div",{className:"font-bold",children:"nft.storage token"}),(0,i.jsx)("input",{type:"text",id:"nft-storage-token",className:"rounded",required:!0})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("div",{className:"font-bold",children:"Asset ID"}),(0,i.jsx)("input",{type:"text",id:"asset-id",className:"rounded mr-4",onChange:function(t){e.current.metadata.value=""},required:!0}),(0,i.jsx)("button",{type:"button",className:"rounded bg-black text-white px-4 py-2",onClick:m,children:"Load"})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("div",{className:"font-bold",children:"Metadata"}),(0,i.jsx)("textarea",{id:"metadata",className:"font-mono rounded resize",required:!0})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("div",{className:"font-bold",children:"New image"}),(0,i.jsx)("input",{type:"file",id:"image-file",className:"rounded mr-4"})]}),(0,i.jsx)("button",{type:"submit",className:"rounded bg-black text-white px-4 py-2 disabled:bg-gray-200",disabled:n,children:"Send"})]}),(0,i.jsx)("div",{className:"text-gray-400",ref:t})]}),(0,i.jsxs)("div",{className:"text-gray-400 mb-4 mt-5",children:["Powered by ",(0,i.jsx)("a",{href:"https://algonode.io/",target:"_blank",children:"Algonode.io"})]})]})]})}},5338:function(){},8127:function(){},2895:function(){},6795:function(){}},function(e){e.O(0,[47,774,888,179],function(){return e(e.s=5356)}),_N_E=e.O()}]);